<%#-- copyright
OpenProject is a project management system.

Copyright (C) 2012-2013 the OpenProject Team

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License version 3.

See doc/COPYRIGHT.rdoc for more details.

++#%>

<% @hours.collect {|h| h[criterias[level]].to_s}.uniq.each do |value| %>
  <% hours_for_value = select_hours(hours, criterias[level], value) -%>
  <% next if hours_for_value.empty? -%>
  <tr class="<%= cycle('odd', 'even') %> <%= 'last-level' unless criterias.length > level+1 %>">
    <%= ('<td></td>' * level).html_safe %>
    <td><%= h(format_criteria_value(criterias[level], value)) %></td>
    <%= ('<td></td>' * (criterias.length - level - 1)).html_safe -%>
    <% total = 0 -%>
    <% @periods.each do |period| -%>
      <% sum = sum_hours(select_hours(hours_for_value, @columns, period.to_s)); total += sum -%>
      <td class="hours"><%= html_hours("%.2f" % sum) if sum > 0 %></td>
    <% end -%>
    <td class="hours"><%= html_hours("%.2f" % total) if total > 0 %></td>
  </tr>
  <% if criterias.length > level+1 -%>
    <%= render(:partial => 'report_criteria', :locals => {:criterias => criterias, :hours => hours_for_value, :level => (level + 1)}) %>
  <% end -%>
<% end %>
